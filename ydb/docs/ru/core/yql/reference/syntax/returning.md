# RETURNING

`RETURNING` используется для возврата информации о строках, которые были изменены в результате выполнения операций [`INSERT`](insert_into.md), [`UPDATE`](update.md), [`DELETE`](delete.md) или [`UPSERT`](upsert_into.md). Это позволяет получить данные о затронутых строках сразу после выполнения операции, что может быть полезно для отладки, логирования и других задач.

## Поведение в связке с другими командами

* При использовании с `INSERT`, `RETURNING` возвращает данные о вставленных строках.
* При использовании с `UPDATE`, `RETURNING` возвращает данные об обновлённых строках. Можно указать конкретные столбцы, данные которых нужно вернуть.
* При использовании с `DELETE`, `RETURNING` возвращает данные об удалённых строках. Это может быть полезно для аудита и отладки.
* При использовании с `UPSERT` (операция, которая объединяет возможности `INSERT` и `UPDATE`), `RETURNING` позволяет получить информацию о строках, которые были вставлены или обновлены в результате выполнения операции. Это помогает убедиться, что данные были изменены так, как ожидалось, и получить детали о произведённых изменениях.

## Пример использования с UPSERT

```sql
UPSERT INTO test 
SELECT * 
FROM (
    SELECT * FROM $new_data 
    UNION ALL 
    SELECT * FROM $toUpsert_0
) 
RETURNING *;
```

В этом примере команда `UPSERT` вставляет или обновляет данные в таблице `test`, используя данные из двух источников (`$new_data` и `$toUpsert_0`), объединенные с помощью `UNION ALL`. Ключевое слово `RETURNING *` указывает на то, что должны быть возвращены все столбцы строк, затронутых операцией `UPSERT`.

{% note info %}

При использовании RETURNING с операциями, затрагивающими большое количество строк, может увеличиться нагрузка на систему из-за возврата большого объёма данных. Перед использованием RETURNING в производственной среде рекомендуется провести тестирование и оценить влияние на производительность системы.

{% endnote %}
